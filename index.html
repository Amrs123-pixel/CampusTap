<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CampusTap â€” Login</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-green-700 flex items-center justify-center min-h-screen">

  <div class="bg-white p-6 rounded-lg shadow-lg w-80">
    <h1 class="text-2xl font-bold text-center text-green-700">CampusTap</h1>
    <p class="text-xs text-center text-gray-500 mb-4">RFID payment + Live GPS</p>

    <input id="name" class="border w-full p-2 rounded mb-2" placeholder="Full Name">
    <input id="email" class="border w-full p-2 rounded mb-2" placeholder="Email">
    <input id="password" class="border w-full p-2 rounded mb-4" type="password" placeholder="Password">

    <button id="registerBtn" class="bg-green-600 text-white p-2 rounded w-full mb-2">Register</button>
    <button id="loginBtn" class="bg-blue-600 text-white p-2 rounded w-full">Login</button>

    <p id="msg" class="text-center text-red-500 text-xs mt-3"></p>
  </div>

  <script type="module">
    import { auth, db } from "./firebase-config.js";
    import { createUserWithEmailAndPassword, signInWithEmailAndPassword } 
      from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";
    import { setDoc, doc } 
      from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

    const msg = document.getElementById("msg");

    document.getElementById("registerBtn").onclick = async () => {
      const name = name.value;
      const email = email.value;
      const pass = password.value;

      try {
        const user = await createUserWithEmailAndPassword(auth, email, pass);
        await setDoc(doc(db, "users", user.user.uid), {
          name,
          email,
          balance: 100,
          role: email.includes("@usc.edu.ph") ? "admin" : "user"
        });

        location.href = "campustap.html";
      } catch (e) {
        msg.innerText = e.message;
      }
    };

    document.getElementById("loginBtn").onclick = async () => {
      try {
        await signInWithEmailAndPassword(auth, email.value, password.value);
        location.href = "campustap.html";
      } catch (e) {
        msg.innerText = e.message;
      }
    };
  </script>

</body>
</html>
